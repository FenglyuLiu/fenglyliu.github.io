# 最小化追踪系统使用说明

## 🎯 系统概述

您的网站现在使用**最小化追踪模式**，专门收集您需要的数据：
- ✅ **页面访问**：用户访问了哪些页面
- ✅ **停留时间**：用户在每页停留多长时间
- ✅ **无需用户同意**：符合隐私法规要求
- ✅ **智能过滤**：自动排除您自己的访问和测试数据

## 📊 收集的数据

### 页面访问数据
- 页面路径（如：`/projects`, `/photography`）
- 页面标题
- 访问时间戳
- 页面停留时间（秒）

### 不收集的数据
- ❌ 用户身份信息
- ❌ 点击事件
- ❌ 滚动深度
- ❌ 个人行为数据
- ❌ 管理员访问（您的访问）
- ❌ 测试页面访问

## 🔧 设置步骤

### 1. 配置 Google Analytics 4（可选）
```javascript
// 在 src/components/Analytics.astro 中替换
const GA4_MEASUREMENT_ID = 'G-XXXXXXXXXX'; // 您的 GA4 ID
```

### 2. 配置访问过滤
1. 访问 `/admin` 管理员控制面板
2. 标记为管理员（您的访问将被过滤）
3. 查看过滤状态和统计信息

### 3. 测试追踪功能
1. 访问您的网站
2. 浏览几个页面
3. 访问 `/analytics` 查看数据
4. 访问 `/test-tracking` 测试功能

## 🛡️ 智能过滤功能

### 自动过滤规则
系统会自动过滤以下访问：
- ✅ **本地开发环境**：localhost, 127.0.0.1
- ✅ **测试域名**：包含 'dev' 或 'test' 的域名
- ✅ **管理员标记**：标记为管理员的浏览器
- ✅ **测试页面**：/test-tracking, /analytics, /privacy-settings
- ✅ **用户代理**：包含 'admin', 'test', 'dev' 关键词

### 管理员控制
- 访问 `/admin` 页面管理过滤设置
- 手动标记/取消管理员状态
- 查看过滤统计和状态
- 导出过滤后或原始数据

## 📈 查看分析数据

### 访问分析页面
- 访问 `/analytics` 查看实时数据（已过滤）
- 查看今日访问者数量
- 查看页面浏览量
- 查看平均停留时间
- 查看热门页面排行
- 查看页面停留时间分析

### 数据特点
- **实时更新**：数据每30秒自动刷新
- **本地存储**：数据保存在用户浏览器中
- **自动过期**：数据定期清理，保护隐私
- **匿名处理**：无法识别个人身份

## 🛡️ 隐私保护

### 符合法规要求
- ✅ **GDPR 合规**：最小化数据收集
- ✅ **CCPA 合规**：匿名数据处理
- ✅ **中国《个人信息保护法》**：不收集个人身份信息

### 隐私提示
- 首次访问时显示简短信息提示
- 3秒后自动隐藏
- 无需用户点击同意
- 用户可以随时清除数据

## 📱 使用方法

### 查看访问者数据
1. 访问 `/analytics` 页面
2. 查看实时统计信息
3. 分析页面访问模式
4. 了解用户停留时间

### 导出数据
1. 在分析页面点击"导出数据"
2. 下载 JSON 格式文件
3. 用于进一步分析

### 清除数据
1. 在分析页面点击"清除数据"
2. 确认操作
3. 所有本地数据将被删除

## 🔍 数据分析示例

### 典型数据格式
```json
{
  "eventType": "page_view",
  "data": {
    "path": "/projects",
    "title": "Projects - Portfolio",
    "timestamp": 1703123456789,
    "timeOnPage": 45
  },
  "visitor": {
    "sessionId": "session_1703123456789_abc123",
    "timestamp": 1703123456789
  }
}
```

### 分析指标
- **页面访问次数**：每个页面的访问量
- **平均停留时间**：用户在页面的平均停留时间
- **热门页面**：访问量最高的页面
- **访问模式**：用户的浏览路径

## ⚙️ 自定义配置

### 修改追踪间隔
```javascript
// 在 Analytics.astro 中修改
trackingInterval: 5, // 每5秒更新一次停留时间
```

### 修改会话超时
```javascript
sessionTimeout: 30, // 30分钟会话超时
```

## 🚀 部署说明

### 静态网站部署
- 系统完全基于客户端
- 无需后端服务器
- 支持所有静态托管平台
- 数据存储在用户浏览器中

### 性能优化
- 异步加载，不影响页面性能
- 本地存储，减少网络请求
- 自动数据清理，避免存储溢出

## 📞 技术支持

### 常见问题
1. **数据不显示**：检查浏览器控制台错误
2. **追踪不工作**：确认 JavaScript 已启用
3. **隐私提示不显示**：清除浏览器缓存

### 调试方法
```javascript
// 在浏览器控制台查看数据
console.log(localStorage.getItem('tracking_data'));
console.log(localStorage.getItem('visitor_analytics'));
```

## 🎉 总结

您的网站现在具备了：
- ✅ 页面访问追踪
- ✅ 停留时间分析
- ✅ 实时数据仪表板
- ✅ 隐私合规保护
- ✅ 无需用户同意
- ✅ 简单易用

开始收集您需要的访问者行为数据，了解用户如何与您的网站互动！
